{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 7, "column": 0}, "map": {"version":3,"sources":["file:///Users/ixyo/Documents/cheersdo/src/app/dashboard/page.tsx"],"sourcesContent":["\"use client\";\nimport { useRouter } from \"next/navigation\";\nimport { useEffect, useState } from \"react\";\nimport DatePicker from \"react-datepicker\";\nimport \"react-datepicker/dist/react-datepicker.css\";\n\nimport Link from \"next/link\";\n\ntype Priority = \"Low\" | \"Medium\" | \"High\";\ntype Todo = {\n  id: number;\n  text: string;\n  done: boolean;\n  priority: \"Low\" | \"Medium\" | \"High\";\n  deadline?: string; //ISO string\n};\n\nconst POINTS_MAP = {\n  Low: 1,\n  Medium: 2,\n  High: 3,\n};\nexport default function Dashboard() {\n  const router = useRouter();\n  const [email, setEmail] = useState(\"\");\n  const [todos, setTodos] = useState<Todo[]>([]);\n  const [newTodo, setNewTodo] = useState(\"\");\n  const [priority, setPriority] = useState<Priority>(\"Low\");\n  const [points, setPoints] = useState(0);\n  const [threshold, setThreshold] = useState(10);\n  const [deadline, setDeadline] = useState(\"\");\n  const [isSaving, setIsSaving] = useState(false);\n  const [selectedDate, setSelectedDate] = useState<Date | null>(null);\n\n  //checking login\n  useEffect(() => {\n    const storedEmail = localStorage.getItem(\"email\");\n    if (!storedEmail) {\n      router.push(\"/login\");\n    } else {\n      setEmail(storedEmail);\n      fetchUserAndTodos(storedEmail);\n    }\n  }, [router]);\n\n  const fetchUserAndTodos = async (email: string) => {\n    try {\n      const resUser = await fetch(`/api/user?email=${email}`);\n      const userData = await resUser.json();\n      const userId = userData?.user?.id;\n\n      if (!userData) return;\n\n      const res = await fetch(`/api/todo?userID=${userId}`);\n      const todoData = await res.json();\n      const loadedTodos: Todo[] = todoData.todos;\n      setTodos(loadedTodos);\n\n      const totalPoints = loadedTodos.reduce((sum, t) => {\n        return t.done ? sum + getPoints(t.priority) : sum;\n      }, 0);\n      setPoints(totalPoints);\n    } catch (error) {\n      console.error(\"Failed to fetch todos\", error);\n    }\n  };\n\n  const addTodo = async () => {\n    if (newTodo.trim() === \"\") return;\n    const todo: Todo = {\n      id: Date.now(),\n      text: newTodo.trim(),\n      done: false,\n      priority,\n      deadline: deadline || undefined,\n    };\n    setIsSaving(true);\n    try {\n      const res = await fetch(\"/api/todo\", {\n        method: \"POST\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({\n          text: todo.text,\n          deadline: todo.deadline,\n          priority: todo.priority,\n          done: todo.done,\n          userEmail: email, // ‡∏à‡∏≤‡∏Å localStorage\n        }),\n      });\n      if (!res.ok) {\n        const errText = await res.text();\n        console.error(\"Failed to save to DB\", errText);\n      } else {\n        const result = await res.json();\n        console.log(\"Saved to DB:\", result);\n      }\n    } catch (error) {\n      console.error(\"API error\", error);\n    }\n    setTodos([todo, ...todos]);\n    setNewTodo(\"\");\n    setIsSaving(false);\n    await fetchUserAndTodos(email);\n  };\n\n  const getPoints = (p: Priority) => POINTS_MAP[p];\n\n  const toggleTodo = async (id: number) => {\n    const targetTodo = todos.find((t) => t.id === id);\n    if (!targetTodo) return;\n    const newDone = !targetTodo.done;\n    try {\n      const res = await fetch(`/api/todo/${id}`, {\n        method: \"PUT\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n        },\n        body: JSON.stringify({ done: newDone }),\n      });\n      console.log(\"newDone\", newDone);\n      if (!res.ok) {\n        console.error(\"Failed to update DB\");\n        return;\n      }\n\n      setTodos((prev) =>\n        prev.map((t) => {\n          if (t.id === id) {\n            const newDone = !t.done;\n            return { ...t, done: newDone };\n          }\n          return t;\n        })\n      );\n      if (newDone) {\n        setPoints((p) => p + getPoints(targetTodo.priority));\n      } else {\n        setPoints((p) => p - getPoints(targetTodo.priority));\n      }\n    } catch (error) {\n      console.error(\"Failed to update DB\", error);\n    }\n  };\n\n  const deleteTodo = (id: number) => {\n    const todoToDelete = todos.find((t) => t.id === id);\n    if (todoToDelete?.done) {\n      setPoints((p) => p - getPoints(todoToDelete.priority));\n    }\n    setTodos((prev) => prev.filter((t) => t.id !== id));\n  };\n\n  const editTodo = (id: number, newText: string) => {\n    setTodos((prev) =>\n      prev.map((t) => (t.id === id ? { ...t, text: newText } : t))\n    );\n  };\n\n  return (\n    <div className=\"p-6 max-w-xl mx-auto\">\n      <Link href=\"/login\" className=\"bg-white text-black rounded p-0.5\">\n        Back\n      </Link>\n      <div className=\"flex py-2\">\n        <Link href=\"/\">\n          <h1 className=\"text-2xl font-bold mb-4\">CheersDo </h1>\n        </Link>\n        <h1 className=\"text-2xl font-bold mb-4 px-2\">Dashboard</h1>\n      </div>\n      <div>\n        <div className=\"mb-6 text-gray-500 flex\">\n          You are : <p className=\"font-bold text-white px-2\">{email}</p>{\" \"}\n        </div>\n      </div>\n\n      <div className=\"flex flex-col sm:flex-row gap-2 mb-4\">\n        <input\n          type=\"text\"\n          value={newTodo}\n          onChange={(e) => setNewTodo(e.target.value)}\n          placeholder=\"Add new task\"\n          className=\"flex-1 border p-2 rounded\"\n        />\n        <div>\n          <DatePicker\n            selected={selectedDate}\n            value={deadline}\n            onChange={(date) => {\n              setDeadline(date);\n              onchange(date!);\n            }}\n            showTimeSelect\n            timeFormat=\"HH:mm\"\n            timeIntervals={15}\n            dateFormat=\"MMMM d, yyyy h:mm aa\"\n            minDate={new Date()} // ‡∏´‡πâ‡∏≤‡∏°‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á\n            minTime={new Date()} // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡πÉ‡∏ô‡∏≠‡∏î‡∏µ‡∏ï (‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ)\n            className=\"p-2 border rounded-md shadow-sm focus:outline-none\"\n            className=\"border-2 p-2 rounded\"\n          />\n        </div>\n        <select\n          value={priority}\n          onChange={(e) => setPriority(e.target.value as Priority)}\n        >\n          <option value=\"Low\">Low</option>\n          <option value=\"Medium\">Medium</option>\n          <option value=\"High\">High</option>\n        </select>\n        <button\n          onClick={addTodo}\n          className=\"bg-blue-600 text-white px-4 py-2 rounded\"\n          disabled={isSaving}\n        >\n          Add\n        </button>\n      </div>\n      <ul className=\"space-y-2\">\n        {todos.map((todo) => (\n          <li\n            key={todo.id}\n            className=\"flex items-center justify-between bg-gray-100 p-2 rounded\"\n          >\n            <div className=\"flex items-center gap-2\">\n              <input\n                type=\"checkbox\"\n                checked={!!todo.done}\n                onChange={() => toggleTodo(todo.id)}\n              />\n              <input\n                type=\"text\"\n                autoFocus\n                value={todo.text}\n                onChange={(e) => editTodo(todo.id, e.target.value)}\n                className={`bg-transparent border-none outline-none w-full text-black px-2\n                  ${todo.done ? \"line-through text-gray-500\" : \"text-black\"}`}\n              />\n              {todo.deadline && (\n                <span className=\"text-xs text-gray-500 ml-2\">\n                  üïí{new Date(todo.deadline).toLocaleString()}\n                </span>\n              )}\n              <span\n                className={`text-sm px-2 py-1 rounded-full ${\n                  todo.priority === \"High\"\n                    ? \"bg-red-300 text-white\"\n                    : todo.priority === \"Medium\"\n                    ? \"bg-yellow-200 text-gray-600\"\n                    : \"bg-green-200 text-black\"\n                }`}\n              >\n                {todo.priority}\n              </span>\n            </div>\n            <button\n              onClick={() => deleteTodo(todo.id)}\n              className=\"text-red-500 hover:text-red-700\"\n            >\n              ‚ùå\n            </button>\n          </li>\n        ))}\n      </ul>\n      <div className=\"mt-6 text-center\">\n        <p className=\"text-lg font-semibold\">\n          üéØ Points: <span className=\"text-green-600\">{points}</span>\n        </p>\n        <p>\n          Set your reward threshold:\n          <input\n            type=\"number\"\n            value={threshold}\n            onChange={(e) => setThreshold(parseInt(e.target.value))}\n            className=\"border p-1 w-16 ms-2 text-center rounded\"\n          />\n        </p>\n        {points >= threshold && (\n          <div className=\"mt-3 bg-green-100 text-green-800 p-4 rounded shadow\">\n            üéâ You‚Äôve earned {points} points! Time to reward yourself!\n            <br />\n            <span className=\"text-sm\">You deserve it. üç¶üé¨üöó</span>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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","debugId":null}}]
}